{% extends "layout.html" %}
{% block content %}
<div class="dashboard">
    <h2>Welcome, {{ player.name }}!</h2>
    <div class="stats-grid card">
        <div class="stat-card"><h3>Wins</h3><p>{{ player.wins }}</p></div>
        <div class="stat-card"><h3>Losses</h3><p>{{ player.losses }}</p></div>
        <div class="stat-card"><h3>Total Matches</h3><p>{{ player.wins + player.losses }}</p></div>
    </div>

    <h3>Your Match History</h3>
    {% if matches %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Your Partner</th>
                    <th>Opponents</th>
                    <th>Score</th>
                    <th>Remark</th>
                    <th>Result</th>
                </tr>
            </thead>
            <tbody>
                {% for match in matches %}
                {% set win_condition = (player.username in [match.male_player1, match.female_player1] and match.winner_team == 'Team 1') or (player.username in [match.male_player2, match.female_player2] and match.winner_team == 'Team 2') %}
                <tr class="{% if match.status == 'completed' %}{% if win_condition %}match-win{% else %}match-loss{% endif %}{% endif %}">
                    <td data-label="Your Partner">{{ match.partner_name }}</td>
                    <td data-label="Opponents">{{ match.opponents_names }}</td>
                    <td data-label="Score">{{ match.score if match.score else '-'}}</td>
                    <td data-label="Remark">{{ match.remark if match.remark else '-'}}</td>
                    <td data-label="Result">
                        {% if match.status == 'completed' %}
                            {% if win_condition %}<span class="result-win-text">Win</span>{% else %}<span class="result-loss-text">Loss</span>{% endif %}
                        {% else %}
                             <span class="status-{{ match.status }}">{{ match.status }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="card">You have no matches on record.</p>
    {% endif %}
</div>
{% endblock %}
